<?php
//proxiy list
$proxies = [
  "23.94.59.115:8080",
  "45.77.173.158:8080",
  "178.128.126.86:3128",
  "138.201.5.159:3128",
  "51.15.242.202:8888",
  "192.111.139.165:4145",
  "51.68.207.81:80",
  "202.5.56.71:8080",
  "103.216.82.198:6667",
  "149.28.149.145:8080",
  "185.199.84.161:53281",
  "198.50.152.64:23500",
  "104.248.115.236:8080",
  "51.79.50.22:9300",
  "46.101.132.35:8080",
  "165.22.223.174:8080",
  "206.189.157.54:8080",
  "51.79.50.31:9300",
  "91.134.221.168:80",
  "47.254.94.44:443",
  "104.236.248.219:3128",
  "139.162.78.109:8080",
  "212.83.168.12:5836",
  "103.216.82.195:6667",
  "178.128.126.158:8080",
  "123.456.789.0:8080",
  "123.456.789.1:8080",
  "123.456.789.2:8080",
  "123.456.789.3.8080",
];

//  user agent list
$user_agents = [
  "Mozilla/5.0 (Linux; U; Android 4.0.3; ko-kr; LG-L160L Build/IML74K) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30",
  "Mozilla/5.0 (Linux; U; Android 4.0.3; de-ch; HTC Sensation Build/IML74K) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30",
  "Mozilla/5.0 (Linux; U; Android 2.3; en-us) AppleWebKit/999+ (KHTML, like Gecko) Safari/999.9",
  "Mozilla/5.0 (Linux; U; Android 2.3.5; zh-cn; HTC_IncredibleS_S710e Build/GRJ90) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1",
  "Mozilla/5.0 (Linux; U; Android 2.3.5; en-us; HTC Vision Build/GRI40) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1",
  "Mozilla/5.0 (Linux; U; Android 2.3.4; fr-fr; HTC Desire Build/GRJ22) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1",
  "Mozilla/5.0 (Linux; U; Android 2.3.4; en-us; T-Mobile myTouch 3G Slide Build/GRI40) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1",
  "Mozilla/5.0 (Linux; U; Android 2.3.3; zh-tw; HTC_Pyramid Build/GRI40) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1",
  "Mozilla/5.0 (Linux; U; Android 2.3.3; zh-tw; HTC_Pyramid Build/GRI40) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari",
  "Mozilla/5.0 (Linux; U; Android 2.3.3; zh-tw; HTC Pyramid Build/GRI40) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1",
  "Mozilla/5.0 (Linux; U; Android 2.3.3; ko-kr; LG-LU3000 Build/GRI40) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1",
  "Mozilla/5.0 (Linux; U; Android 2.3.3; en-us; HTC_DesireS_S510e Build/GRI40) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1",
  "Mozilla/5.0 (Linux; U; Android 2.3.3; en-us; HTC_DesireS_S510e Build/GRI40) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile",
  "Mozilla/5.0 (Linux; U; Android 2.3.3; de-de; HTC Desire Build/GRI40) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1",
  "Mozilla/5.0 (Linux; U; Android 2.3.3; de-ch; HTC Desire Build/FRF91) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1",
  "Mozilla/5.0 (Linux; U; Android 2.2; fr-lu; HTC Legend Build/FRF91) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1",
  "Mozilla/5.0 (Linux; U; Android 2.2; en-sa; HTC_DesireHD_A9191 Build/FRF91) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1",
  "Mozilla/5.0 (Linux; U; Android 2.2.1; fr-fr; HTC_DesireZ_A7272 Build/FRG83D) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1",
  "Mozilla/5.0 (Linux; U; Android 2.2.1; en-gb; HTC_DesireZ_A7272 Build/FRG83D) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1",
  "Mozilla/5.0 (Linux; U; Android 2.2.1; en-ca; LG-P505R Build/FRG83) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1",
  "Mozilla/5.0 (Linux; U; Android 2.2.1; de-de; HTC_Wildfire_A3333 Build/FRG83D) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1",
  "Mozilla/5.0 (Linux; U; Android 2.1-update1; es-mx; SonyEricssonE10a Build/2.0.A.0.504) AppleWebKit/530.17 (KHTML, like Gecko) Version/4.0 Mobile Safari/530.17",
  "Mozilla/5.0 (Linux; U; Android 1.6; ar-us; SonyEricssonX10i Build/R2BA026) AppleWebKit/528.5+ (KHTML, like Gecko) Version/3.1.2 Mobile Safari/525.20.1",
  "Mozilla/5.0 (Linux; U; Android 1.6; ar-us; SonyEricssonX10i Build/R2BA026)
  AppleWebKit/528.5+ (KHTML, like Gecko) Version/3.1.2 Mobile Safari/525.20.1",

];

// Set the target URL for scraping
$start_url = "your Url .com";

$visited_urls = []; // To track visited URLs
$max_depth = 3; // Depth to crawl
//you can chnge to 1 incase you only want to scrape a singel page

/**
 * Start the scraping process
 */
function scrape_site($url, $depth = 0)
{
  global $visited_urls, $max_depth;

  if ($depth > $max_depth || in_array($url, $visited_urls)) {
    return; // Stop if depth exceeded or URL already visited
  }

  echo "Scraping: $url\n";

  $html = fetch_html($url);
  if (!$html) {
    return; // if no HTML returned
  }

  // Save HTML content to file
  save_html_to_file($url, $html);

  // Mark the URL as visited
  $visited_urls[] = $url;

  // Extract all internal links and scrape them recursively
  $links = extract_internal_links($html, $url);
  foreach ($links as $link) {
    scrape_site($link, $depth + 1);
  }
}

/**
 * Fetch the HTML content of the URL
 */
function fetch_html($url)
{
  global $proxies, $user_agents;

  // Set Random proxy and user agent
  $random_proxy = $proxies[array_rand($proxies)];
  $random_user_agent = $user_agents[array_rand($user_agents)];

  $ch = curl_init();
  curl_setopt($ch, CURLOPT_URL, $url);
  curl_setopt($ch, CURLOPT_PROXY, $random_proxy);
  curl_setopt($ch, CURLOPT_HTTPHEADER, ["User-Agent: " . $random_user_agent]);
  curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
  curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);

  $html = curl_exec($ch);

  if (curl_errno($ch)) {
    echo "cURL Error: " . curl_error($ch) . "\n";
    curl_close($ch);
    return false;
  }

  curl_close($ch);
  return $html;
}

/**
 * Save the HTML content to a local file
 */
function save_html_to_file($url, $html)
{
  // Create a directory to save files if noy exits you can  change folder name
  $folder = "scraped_pages";
  if (!is_dir($folder)) {
    mkdir($folder);
  }

  // Create a filename based on the URL
  $parsed_url = parse_url($url);
  $path = isset($parsed_url["path"]) ? $parsed_url["path"] : "index";
  $filename = $folder . "/" . trim(str_replace("/", "_", $path), "_") . ".html";

  // Save the HTML to the file
  file_put_contents($filename, $html);
  echo "Saved HTML to: $filename\n";
}

/**
 * Extract all internal links from the HTML content
 */
function extract_internal_links($html, $base_url)
{
  $dom = new DOMDocument();
  @$dom->loadHTML($html); // Suppress warnings for malformed HTML

  $links = [];

  // Extract all <a> tags with href attributes
  foreach ($dom->getElementsByTagName("a") as $node) {
    $href = $node->getAttribute("href");
    if (!empty($href)) {
      $absolute_url = make_absolute_url($href, $base_url);

      // Only include links that are part of the original domain
      $parsed_base = parse_url($base_url);
      $parsed_link = parse_url($absolute_url);

      if (
        isset($parsed_link["host"]) &&
        $parsed_link["host"] == $parsed_base["host"]
      ) {
        $links[] = $absolute_url;
      }
    }
  }

  // Remove duplicates
  return array_unique($links);
}

/**
 * Converts a relative URL to an absolute URL.
 */
function make_absolute_url($relative_url, $base_url)
{
  if (parse_url($relative_url, PHP_URL_SCHEME) != "") {
    return $relative_url;
  }

  // Convert relative URL to absolute URL
  return rtrim($base_url, "/") . "/" . ltrim($relative_url, "/");
}

// Start scraping from the initial url
scrape_site($start_url);

?>
